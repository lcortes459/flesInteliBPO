{{extend plantilla()}}
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="card card-primary card-outline">
                    <div class="card-body box-profile">
                        <div class="text-center">
                            <img class="profile-user-img img-fluid img-circle" src="{{=getFotoUsuario(idUser)}}" alt="User profile picture">
                        </div>

                        <h3 class="profile-username text-center"> {{=str(nameUser).capitalize() }}</h3>

                        <p class="text-muted text-center"><b>{{#=getDoliente(idUser)}}</b></p>
                        <hr>
                        <a href="{{=URL('default','user/logout')}}" class="btn btn-primary btn-block"><b>Cerrar Sessión</b></a>
                    </div>
                </div>
            </div>
            <div class="col-md-9">
                <div class="card">
                    <div class="card-header p-2">
                        <ul class="nav nav-pills">
                            <li class="nav-item"><a class="nav-link active" href="#settings" data-toggle="tab">Configuración Usuario</a></li>
                            <li class="nav-item"><a class="nav-link" href="#settings_empleado" data-toggle="tab">Configuración Empleado</a></li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <div class="active tab-pane" id="settings">
                              <div id="newUsuarios">
                                <div class="card card-primary">
                                  {{#for mul in multi_usuario:}}
                                    <form role="form" id="formUsuarioUpdate" onsubmit="return false;">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="form-group col col-4">
                                                  <label for="tipo_update">Tipo Usuario</label>
                                                  <input type="text" value="{{#=mul['usuario'].tipo}}" class="form-control" disabled="">
                                                </div>
                                                <div class="form-group col col-4">
                                                  <label for="first_name_update">Usuario</label>
                                                  <input type="text" class="form-control" disabled="" value="{{#=mul['usuario'].first_name}}">

                                                  <!-- Variables definidas -->
                                                  <input type="hidden" class="form-control" id="first_name_update" name="first_name_update" value="{{#=mul['usuario'].first_name}}">
                                                  <input type="hidden" value="{{#=mul['usuario'].tipo}}" name="tipo_update" id="tipo_update">
                                                  <!-- <input type="hidden" id="id" name="id" value="{{#=mul['usuario'].id}}"> -->
                                                  <input type="hidden" value="{{#=mul['usuario'].estado}}" id="estado_update" name="estado_update">
                                                  <input type="hidden" value="{{#=mul['usuario'].fecha_creacion}}" id="fecha_creacion_update" name="fecha_creacion_update">
                                                  <input type="hidden" value="{{#=mul['usuario'].sucursal}}" id="sucursal_update" name="sucursal_update">
                                                  <input type="hidden" value="{{#=mul['usuario'].empresa}}" id="empresa_update" name="empresa_update">
                                                  <input type="hidden" value="{{#=mul['usuario'].fechaactualizacionpass}}" id="fechaactualizacionpass_update" name="fechaactualizacionpass_update">
                                                  <input type="hidden" value="{{#=mul['usuario'].last_name}}" id="last_name_update" name="last_name_update">
                                                  <input type="hidden" name="rama_update" id="rama_update" value="{{#=mul['usuario'].rama}}">
                                                  <input type="hidden" value="{{#=mul['usuario'].email}}"  id="email_update" name="email_update">
                                                  <input type="hidden" value="{{#=mul['idEmpleado']}}" id="doliente_update" name="doliente_update">
                                                  <!-- Fin variables definidas -->
                                                </div>
                                                <div class="form-group col col-4">
                                                  <label for="email_update">Email</label>
                                                  <input type="text" value="{{#=mul['usuario'].email}}" class="form-control" disabled="">
                                              </div>
                                            </div>
                                            <div class="row">
                                                <div class="form-group col col-4">
                                                    <label for="rama_update">Ramas</label>
                                                    <input type="text" value="{{#=mul['rama']}}" class="form-control" disabled="">
                                                </div>
                                                <div class="form-group col col-4">
                                                    <label for="rama_update">Doliente</label>
                                                    <input type="text" value="{{#=mul['empleado']}}" class="form-control" disabled="">
                                                </div>
                                                <div class="form-group col col-4">
                                                  <label for="password">Password (*)</label>
                                                  <input type="password" id="password" name="password" value="**************" class="form-control" autofocus="">
                                                </div>
                                            </div>
                                      </div>
                                      <div class="card-footer">
                                          <div class="row" id="botoneraActualizar">
                                              <!-- <div class="col col-6"> 
                                                  <a href="#!" class="btn btn-default btn-block">Limpiar</a>
                                              </div> -->
                                              <div class="col col-12"> 
                                                  <a href="#!"  class="btn btn-block btn-success"  id="btnActualizar">Actualizar Password</a>
                                              </div>
                                          </div>

                                          <div class="row" id="botoneraActualizando" style="display:none;">
                                            <div class="col col-12">    
                                              <a href="#!" class="btn btn-primary btn-block disabled">
                                                <span class="spinner-grow spinner-grow-sm"></span>
                                                  Un momento estamos actualizando sus datos 
                                                <span class="spinner-grow spinner-grow-sm"></span>
                                              </a>
                                            </div>
                                          </div>
                                      </div>
                                    </form>
                                  {{pass}}
                                </div>
                              </div>
                            </div>
                            <div class="tab-pane" id="settings_empleado">
                              <p style="font-size:2em;text-align:center;">
                                <b>Pronto estaré disponible...</b>
                              </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<input type="hidden" id="id" name="id" value="{{=idUser}}">
{{block page_js}}
  <script>
    $(function() {

      $('#btnActualizar').click(function(event) {
        var idUsuario = $('#id').val();
        var password = $('#password').val();
        console.log('id', idUsuario);
        if (password === '') {
          template.validaCampo('Password');
        }else{
          $('#password').attr('disabled', true);
          $('#botoneraActualizar').hide();
          $('#botoneraActualizando').show();
          $.ajax({
            url: '../template/updatePassword',
            type: 'POST',
            dataType: 'json',
            data: {idUsuario:idUsuario,password:password},
          })
          .done(function(data) {
            if (data==0){
              Swal.fire({
                title: "Error",
                text:  "No se pudo realizar el cambio de password",
                type:  "error",
                showCancelButton: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Verificar',
              }).then((result) => {
                $('#password').attr('disabled', false);
                $('#botoneraActualizando').hide();
                $('#botoneraActualizar').show();
              });
            }else{
              Swal.fire({
                title: "Password cambiado con éxito",
                text:  "La session se cerrara para aplicar los cambios",
                type:  "success",
                showCancelButton: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Terminar',
              }).then((result) => {
                window.location.href="../default/user/logout"
              });
            }
          });
        }
      });
    });
  </script>
{{end page_js}}

